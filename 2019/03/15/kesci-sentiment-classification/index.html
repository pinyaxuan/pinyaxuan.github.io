<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><meta name="keywords" content="NLP, ML, PyTorch"><title>【科赛-练习赛】：文本情感分类模型搭建 | 品雅轩</title><link rel="stylesheet" type="text/css" href="//fonts.loli.net/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.3"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.3"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css?v=2.0.3"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js?v=2.0.3"></script><script src="//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js?v=2.0.3"></script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">【科赛-练习赛】：文本情感分类模型搭建</h1><a id="logo" href="/.">品雅轩</a><p class="description">生活有态度 技术有温度 —— Jason Wang</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">【科赛-练习赛】：文本情感分类模型搭建</h1><div class="post-meta"><a href="/2019/03/15/kesci-sentiment-classification/#comments" class="comment-count"></a><p><span class="date">Mar 15, 2019</span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><p>记录参加科赛举办的文本情感分类模型-练习赛，比赛地址： <a target="_blank" rel="noopener" href="https://www.kesci.com/home/competition/5c77ab9c1ce0af002b55af86">文本情感分类模型搭建 | 练习赛</a><br>使用TFIDF提前词频特征，利用PyTorch搭建线性预测模型，预测结果AUC 0.8658，截止2019-3-14科赛网公网排名第三。</p>
<p><img src="/./kesci-sentiment-classification/kesci-sentiment-classification-intro.png" alt="科赛排名（2019-3-14）"></p>
<h2 id="赛题描述"><a href="#赛题描述" class="headerlink" title="赛题描述"></a>赛题描述</h2><p>本练习赛所用数据，是名为「Roman Urdu DataSet」的公开数据集。</p>
<p>这些数据，均为文本数据。原始数据的文本，对应三类情感标签：Positive, Negative, Netural。</p>
<p>本练习赛，移除了标签为Netural的数据样例。因此，练习赛中，所有数据样例的标签为Positive和Negative。</p>
<p>本练习赛的任务是「分类」。「分类目标」是用训练好的模型，对测试集中的文本情感进行预测，判断其情感为「Negative」或者「Positive」。</p>
<h2 id="GitHub"><a href="#GitHub" class="headerlink" title="GitHub"></a>GitHub</h2><p><a target="_blank" rel="noopener" href="https://github.com/jianchengss/kesci-sentiment-classification.git">https://github.com/jianchengss/kesci-sentiment-classification.git</a></p>
<h2 id="提交结果"><a href="#提交结果" class="headerlink" title="提交结果"></a>提交结果</h2><p><img src="/./kesci-sentiment-classification/kesci-sentiment-classification-3.png" alt="科赛排名（2019-3-14）"></p>
<p>实验结果摘要：</p>
<table>
<thead>
<tr>
<th>Date</th>
<th>SHA</th>
<th>Method</th>
<th>AUC-train</th>
<th>AUC-kesci</th>
<th>P</th>
<th>R</th>
<th>F</th>
</tr>
</thead>
<tbody><tr>
<td>20190307</td>
<td>8225844</td>
<td>random</td>
<td>-</td>
<td>0.5057</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>20190312</td>
<td>05a6790</td>
<td>rfc-1</td>
<td>0.8130</td>
<td>0.8054</td>
<td>0.7516</td>
<td>0.7542</td>
<td>0.7520</td>
</tr>
<tr>
<td>20190312</td>
<td>d4e00a1</td>
<td>neural_clf</td>
<td>0.8336</td>
<td>0.8357</td>
<td>0.7831</td>
<td>0.7638</td>
<td>0.7728</td>
</tr>
<tr>
<td>20190313</td>
<td>9dae25e</td>
<td>forest-2</td>
<td>0.8269</td>
<td>0.8229</td>
<td>0.7602</td>
<td>0.7726</td>
<td>0.7656</td>
</tr>
<tr>
<td>20190313</td>
<td>78f2dc7</td>
<td>neural_clf</td>
<td>0.8352</td>
<td>0.8412</td>
<td>0.7723</td>
<td>0.7806</td>
<td>0.7762</td>
</tr>
<tr>
<td>20190313</td>
<td>14075a4</td>
<td>soft_max</td>
<td>0.8369</td>
<td>0.8250</td>
<td>0.7574</td>
<td>0.7911</td>
<td>0.7739</td>
</tr>
<tr>
<td>20190313</td>
<td>a592ca6</td>
<td>soft_max</td>
<td><strong>0.8641</strong></td>
<td>0.8568</td>
<td>0.7930</td>
<td>0.8000</td>
<td>0.7965</td>
</tr>
<tr>
<td>20190313</td>
<td>257fbab</td>
<td>soft_max</td>
<td>0.8520</td>
<td>0.8474</td>
<td>0.7368</td>
<td>0.8252</td>
<td>0.7785</td>
</tr>
<tr>
<td>20190313</td>
<td>25b5456</td>
<td>soft_max</td>
<td>-</td>
<td><strong>0.8658</strong></td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
</tbody></table>
<h2 id="主要实验过程"><a href="#主要实验过程" class="headerlink" title="主要实验过程"></a>主要实验过程</h2><h3 id="公共模块定义"><a href="#公共模块定义" class="headerlink" title="公共模块定义"></a>公共模块定义</h3><p>构建公共处理模块有两个目的，一是方便复用，比方说文件的保存与加载、日志的定义；二是跟实验无关的一些中间处理过程。具体代码间GitHub，主要有：</p>
<p><code>config.py</code> 定义基本配置信息，超参数设置，方便做对比实验；</p>
<p><code>logger.py</code> 日志配置，实验过程保存至日志文件；</p>
<p><code>comm.py</code> 数据的加载与保存等公共方法；</p>
<h3 id="数据处理"><a href="#数据处理" class="headerlink" title="数据处理"></a>数据处理</h3><h3 id="评价方法"><a href="#评价方法" class="headerlink" title="评价方法"></a>评价方法</h3><p>评价方法是评价一个模型好坏的准则，本次比赛测评算法指定为AUC(Area Under the Curve)，AUC值越高可以任务情感分类结果越准确。扩展资料：<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Receiver_operating_characteristic#Area_under_the_curve">AUC-维基百科</a> | <a target="_blank" rel="noopener" href="https://baike.baidu.com/item/AUC/19282953?fr=aladdin">AUC-百度百科</a></p>
<p>scikit-learn 已经有AUC的封装：<code>auc = roc_auc_score(y, y_score, average=&quot;macro&quot;)</code></p>
<p>新建 <code>report.py</code> 模块，定义Report类如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">class Report():</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    对预测结果进行评估</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">    def __init__(self, name=&#x27;&#x27;):</span><br><span class="line">        &#x27;&#x27;&#x27;</span><br><span class="line">        初始化</span><br><span class="line">        &#x27;&#x27;&#x27;</span><br><span class="line">        self.name = name</span><br><span class="line">        self.f1 = []</span><br><span class="line">        self.p1 = []</span><br><span class="line">        self.r1 = []</span><br><span class="line"></span><br><span class="line">        self.f0 = []</span><br><span class="line">        self.p0 = []</span><br><span class="line">        self.r0 = []</span><br><span class="line">        self.auc_scores = []</span><br><span class="line">        self.auc = 0</span><br><span class="line"></span><br><span class="line">    def report_one_folder_by_lable(self, y, y_hat):</span><br><span class="line">        &#x27;&#x27;&#x27;</span><br><span class="line">        中间结果</span><br><span class="line">        &#x27;&#x27;&#x27;</span><br><span class="line">        f1_1 = metrics.f1_score(y, y_hat, pos_label=1)</span><br><span class="line">        p_1 = metrics.precision_score(y, y_hat, pos_label=1)</span><br><span class="line">        r_1 = metrics.recall_score(y, y_hat, pos_label=1)</span><br><span class="line"></span><br><span class="line">        f1_0 = metrics.f1_score(y, y_hat, pos_label=0)</span><br><span class="line">        p_0 = metrics.precision_score(y, y_hat, pos_label=0)</span><br><span class="line">        r_0 = metrics.recall_score(y, y_hat, pos_label=0)</span><br><span class="line"></span><br><span class="line">        self.f1.append(f1_1)</span><br><span class="line">        self.p1.append(p_1)</span><br><span class="line">        self.r1.append(r_1)</span><br><span class="line"></span><br><span class="line">        self.f0.append(f1_0)</span><br><span class="line">        self.p0.append(p_0)</span><br><span class="line">        self.r0.append(r_0)</span><br><span class="line"></span><br><span class="line">        logger.info(&quot;0 result p: &#123;:.4f&#125; r: &#123;:.4f&#125; f &#123;:.4f&#125;&quot;.format(p_0, r_0, f1_0))</span><br><span class="line">        logger.info(&quot;1 result p: &#123;:.4f&#125; r: &#123;:.4f&#125; f &#123;:.4f&#125;&quot;.format(p_1, r_1, f1_1))</span><br><span class="line">        return p_1</span><br><span class="line"></span><br><span class="line">    def report_one_folder(self, y, predict_proba, threshold=0.5):</span><br><span class="line">        &#x27;&#x27;&#x27;</span><br><span class="line">        中间结果</span><br><span class="line">        &#x27;&#x27;&#x27;</span><br><span class="line">        logger.info(self.name)</span><br><span class="line">        y_hat = [1 if score[1] &gt;= threshold else 0 for score in predict_proba]</span><br><span class="line">        p_1 = self.report_one_folder_by_lable(y, y_hat)</span><br><span class="line"></span><br><span class="line">        # auc evaluate</span><br><span class="line">        y_score = predict_proba[:, 1]</span><br><span class="line">        auc = roc_auc_score(y, y_score, average=&quot;macro&quot;)</span><br><span class="line">        self.auc_scores.append(auc)</span><br><span class="line">        logger.info(&quot;AUC score: &#123;:.4f&#125;&quot;.format(auc))</span><br><span class="line"></span><br><span class="line">        self.auc = np.mean(self.auc_scores)</span><br><span class="line">        return auc</span><br><span class="line"></span><br><span class="line">    def report_final_result(self):</span><br><span class="line">        &#x27;&#x27;&#x27;</span><br><span class="line">        最终结果</span><br><span class="line">        &#x27;&#x27;&#x27;</span><br><span class="line">        logger.info(self.name)</span><br><span class="line">        logger.info(</span><br><span class="line">            &quot;0 avg result p: &#123;:.4f&#125; r: &#123;:.4f&#125; f &#123;:.4f&#125;&quot;.format(np.mean(self.p0), np.mean(self.r0), np.mean(self.f0)))</span><br><span class="line">        logger.info(</span><br><span class="line">            &quot;1 avg result p: &#123;:.4f&#125; r: &#123;:.4f&#125; f &#123;:.4f&#125;&quot;.format(np.mean(self.p1), np.mean(self.r1), np.mean(self.f1)))</span><br><span class="line"></span><br><span class="line">        if len(self.auc_scores) &gt; 0:</span><br><span class="line">            ave_auc = np.mean(self.auc_scores)</span><br><span class="line">            logger.info(</span><br><span class="line">                &quot;AUC avg score: &#123;:.4f&#125;&quot;.format(ave_auc))</span><br><span class="line">            return ave_auc</span><br><span class="line">        return np.mean(self.p1)</span><br></pre></td></tr></table></figure>


<h3 id="特征提取"><a href="#特征提取" class="headerlink" title="特征提取"></a>特征提取</h3><p>新建专门的特征提取模块，命名为：<code>feature.py</code>,代码及解释如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">import pandas as pd</span><br><span class="line">from sklearn.feature_extraction.text import TfidfVectorizer</span><br><span class="line"></span><br><span class="line">import config</span><br><span class="line">import word_vec</span><br><span class="line">from logger import logger</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class TFIDF():</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    提取文本的TFIDF特征</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">    def __init__(self, data, min_df=1):</span><br><span class="line">        &#x27;&#x27;&#x27;</span><br><span class="line">        初始化并拟合数据集</span><br><span class="line">        :param data:训练集文本</span><br><span class="line">        &#x27;&#x27;&#x27;</span><br><span class="line">        self.data = data</span><br><span class="line">        logger.info(&#x27;init TfidfVectorizer&#x27;)</span><br><span class="line">        self.tfidf = TfidfVectorizer(min_df=min_df)</span><br><span class="line">        logger.info(&#x27;fitting Tfidf...&#x27;)</span><br><span class="line">        self.train_vec = self.tfidf.fit_transform(data).toarray()</span><br><span class="line">        logger.info(&#x27;end&#x27;)</span><br><span class="line"></span><br><span class="line">    def transform(self, data):</span><br><span class="line">        &#x27;&#x27;&#x27;</span><br><span class="line">        拟合新的数据集</span><br><span class="line">        :param data: 测试集文本</span><br><span class="line">        :return:</span><br><span class="line">        &#x27;&#x27;&#x27;</span><br><span class="line">        return self.tfidf.transform(data).toarray()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Feature():</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    特征提取的封装类</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">    def __init__(self):</span><br><span class="line">        import comm</span><br><span class="line">        # 加载训练集和测试集数据</span><br><span class="line">        self.train_data = comm.load_df(config.train_data_path)</span><br><span class="line">        self.test_data = comm.load_df(config.test_data_path)</span><br><span class="line">        self.test_ids = self.test_data[&quot;ID&quot;]  # 测试集中所有的id</span><br><span class="line">        self.y = self.get_target()  # 训练集中的情感标签</span><br><span class="line"></span><br><span class="line">        self.train_features = []</span><br><span class="line">        self.test_features = []</span><br><span class="line"></span><br><span class="line">        # 提取TFIDF特征</span><br><span class="line">        train_vec, test_vec = self.tfidf_vec()</span><br><span class="line">        self.train_features.append(pd.DataFrame(train_vec))</span><br><span class="line">        self.test_features.append(pd.DataFrame(test_vec))</span><br><span class="line"></span><br><span class="line">        # train_word_vec, test_word_vec = self.word_vec()  # 加了会很低</span><br><span class="line">        # self.train_features.append(pd.DataFrame(train_word_vec))</span><br><span class="line">        # self.test_features.append(pd.DataFrame(test_word_vec))</span><br><span class="line"></span><br><span class="line">        self.X = pd.concat(self.train_features, axis=1)</span><br><span class="line">        self.test_X = pd.concat(self.test_features, axis=1)</span><br><span class="line">        logger.info(&quot;Shape of train X: &#123;&#125;&quot;.format(self.X.shape))</span><br><span class="line">        logger.info(&quot;Shape of test X: &#123;&#125;&quot;.format(self.test_X.shape))</span><br><span class="line">        logger.info(&quot;Shape of y: &#123;&#125;&quot;.format(self.y.shape))</span><br><span class="line"></span><br><span class="line">    def get_target(self):</span><br><span class="line">        def get_lable(label):</span><br><span class="line">            if label == &#x27;Positive&#x27;:</span><br><span class="line">                return 1  # Positive 用1表示</span><br><span class="line">            else:</span><br><span class="line">                return 0</span><br><span class="line"></span><br><span class="line">        # 将训练集中的标签用 0 1表示</span><br><span class="line">        self.train_data[&#x27;y&#x27;] = self.train_data.apply(lambda x: get_lable(x[&#x27;label&#x27;]), axis=1)</span><br><span class="line">        return self.train_data[&#x27;y&#x27;].values.astype(&#x27;int&#x27;)</span><br><span class="line"></span><br><span class="line">    def tfidf_vec(self):</span><br><span class="line">        logger.info(&quot;start collect tfidf vec.&quot;)</span><br><span class="line">        # 用训练集初始化TFIDF</span><br><span class="line">        tfidf = TFIDF(self.train_data[&#x27;review&#x27;], min_df=config.tfidf_min_df)</span><br><span class="line">        train_vec = tfidf.train_vec</span><br><span class="line">        # 提取测试集的TFIDF特征</span><br><span class="line">        test_vec = tfidf.transform(self.test_data[&#x27;review&#x27;])</span><br><span class="line">        logger.info(&quot;shape of trian tfidf: &#123;&#125;&quot;.format(train_vec.shape))</span><br><span class="line">        logger.info(&quot;shape of test tfidf: &#123;&#125;&quot;.format(test_vec.shape))</span><br><span class="line">        return train_vec, test_vec</span><br><span class="line"></span><br><span class="line">    def word_vec(self):</span><br><span class="line">        &#x27;&#x27;&#x27;</span><br><span class="line">        提取文本中的词向量表示</span><br><span class="line">        :return: 训练集词向量，测试集词向量</span><br><span class="line">        &#x27;&#x27;&#x27;</span><br><span class="line">        logger.info(&quot;word vec&quot;)</span><br><span class="line">        train_word_vec = word_vec.get_word_vec(self.train_data[&#x27;review&#x27;])</span><br><span class="line">        test_word_vec = word_vec.get_word_vec(self.test_data[&#x27;review&#x27;])</span><br><span class="line"></span><br><span class="line">        logger.info(&quot;shape of trian word_vec: &#123;&#125;&quot;.format(train_word_vec.shape))</span><br><span class="line">        logger.info(&quot;shape of test word_vec: &#123;&#125;&quot;.format(test_word_vec.shape))</span><br><span class="line">        self.voc = word_vec.voc</span><br><span class="line">        return train_word_vec, test_word_vec</span><br></pre></td></tr></table></figure>

<h3 id="训练过程"><a href="#训练过程" class="headerlink" title="训练过程"></a>训练过程</h3><p>新建训练模块，命名为：<code>train.py</code>,代码及解释如下：</p>
<h4 id="分类器的定义"><a href="#分类器的定义" class="headerlink" title="分类器的定义"></a>分类器的定义</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">classfiers = &#123;&#125;</span><br><span class="line">features_name = []</span><br><span class="line"></span><br><span class="line">C = 1.0</span><br><span class="line"></span><br><span class="line"># classfiers[&#x27;xgb-5&#x27;]  = xgb_5</span><br><span class="line">svm_1 = svm.SVC(C=1.0, kernel=&#x27;rbf&#x27;, gamma=&#x27;auto&#x27;, probability=True)</span><br><span class="line">rfc_1 = RandomForestClassifier(n_estimators=100, random_state=10)</span><br><span class="line">rfc_2 = RandomForestClassifier(n_estimators=200, random_state=10)</span><br><span class="line">rfc_3 = RandomForestClassifier(n_estimators=300, random_state=10)</span><br><span class="line">rfc_4 = RandomForestClassifier(n_estimators=200, max_depth=13, min_samples_split=80, min_samples_leaf=10,</span><br><span class="line">                               oob_score=True, random_state=10, max_features=&#x27;sqrt&#x27;)</span><br><span class="line">rfc_5 = RandomForestClassifier(random_state=30, n_estimators=30, max_depth=11, max_features=0.5,</span><br><span class="line">                               criterion=&#x27;entropy&#x27;, min_samples_split=140, min_samples_leaf=50)</span><br><span class="line"># Build a forest and compute the feature importances</span><br><span class="line">forest_1 = ExtraTreesClassifier(n_estimators=25, random_state=0)</span><br><span class="line">forest_2 = ExtraTreesClassifier(n_estimators=250, random_state=0)</span><br><span class="line">rng = np.random.RandomState(1)</span><br><span class="line">bdt = AdaBoostClassifier(DecisionTreeClassifier(max_depth=3),</span><br><span class="line">                         algorithm=&quot;SAMME&quot;,</span><br><span class="line">                         n_estimators=100)</span><br><span class="line"></span><br><span class="line"># Decision Tree</span><br><span class="line">tree_clf = tree.DecisionTreeClassifier()</span><br><span class="line"></span><br><span class="line"># Gradient Boosting Classifier</span><br><span class="line">grad_clf = GradientBoostingClassifier()</span><br><span class="line"></span><br><span class="line"># Random Forest Classifier</span><br><span class="line">rand_clf = RandomForestClassifier(n_estimators=18)</span><br><span class="line"></span><br><span class="line"># NeuralNet Classifier</span><br><span class="line">neural_clf = MLPClassifier(alpha=1)</span><br><span class="line"></span><br><span class="line"># Naives Bayes</span><br><span class="line">nav_clf = GaussianNB()</span><br><span class="line"></span><br><span class="line">voting_clf = VotingClassifier(</span><br><span class="line">    estimators=[(&#x27;gbc&#x27;, grad_clf), (&#x27;nav&#x27;, nav_clf), (&#x27;neural&#x27;, neural_clf)],</span><br><span class="line">    voting=&#x27;soft&#x27;</span><br><span class="line">)</span><br><span class="line">voting_rfc = VotingClassifier(</span><br><span class="line">    estimators=[(&#x27;rfc&#x27;, rfc_1), (&#x27;rfc_2&#x27;, rfc_2), (&#x27;rfc_3&#x27;, rfc_3)],</span><br><span class="line">    voting=&#x27;soft&#x27;)</span><br><span class="line">classfiers[&#x27;neural_clf&#x27;] = neural_clf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">classfiers[&#x27;nav_clf&#x27;] = nav_clf</span><br><span class="line">classfiers[&#x27;grad_clf&#x27;] = grad_clf</span><br><span class="line">classfiers[&#x27;tree_clf&#x27;] = tree_clf</span><br><span class="line">classfiers[&#x27;forest-1&#x27;] = forest_1</span><br><span class="line">classfiers[&#x27;forest-2&#x27;] = forest_2</span><br><span class="line">classfiers[&#x27;voting_clf&#x27;] = voting_clf</span><br><span class="line">classfiers[&#x27;voting_rfc&#x27;] = voting_rfc</span><br></pre></td></tr></table></figure>
<h4 id="训练过程-1"><a href="#训练过程-1" class="headerlink" title="训练过程"></a>训练过程</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">def cv(X, y, clf):</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    交叉验证 Cross-validation</span><br><span class="line">    :param X: 训练集特征</span><br><span class="line">    :param y: 目标label</span><br><span class="line">    :param clf: 分类器</span><br><span class="line">    :return: 交叉验证过程中的最佳模型</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    model = None</span><br><span class="line">    max_p = 0  # 记录实验中最好的模型</span><br><span class="line">    reporter = Report(&#x27;train&#x27;)  # 定义评价器</span><br><span class="line">    for i in range(1, 10):  # 10</span><br><span class="line">        logger.info(&quot;Folder &#123;&#125;&quot;.format(i))</span><br><span class="line">        x_train, x_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=21 + i)</span><br><span class="line">        if config.DEBUG:</span><br><span class="line">            logger.info(</span><br><span class="line">                &quot;Train x data: (&#123;&#125;, &#123;&#125;), Train y data: &#123;&#125;&quot;.format(len(x_train), len(x_train[0]), Counter(y_train)))</span><br><span class="line">            logger.info(&quot;Test x data: (&#123;&#125;, &#123;&#125;), Test y data: &#123;&#125;&quot;.format(len(x_test), len(x_test[0]), Counter(y_test)))</span><br><span class="line"></span><br><span class="line">        clf.fit(x_train, y_train)  # 训练过程</span><br><span class="line">        predict_proba = clf.predict_proba(x_test)  # 返回每个类别的概率值</span><br><span class="line"></span><br><span class="line">        # TODO 随机 看结果对比submission结果</span><br><span class="line">        p = reporter.report_one_folder(y_test, predict_proba, threshold=0.5)</span><br><span class="line">        if p &gt; max_p:</span><br><span class="line">            max_p = p</span><br><span class="line">            logger.info(&quot;Max result: &#123;:.4f&#125;&quot;.format(p))</span><br><span class="line">            model = clf</span><br><span class="line">    reporter.report_final_result()</span><br><span class="line">    return model, reporter</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def train_cv(X, y):</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    对classfiers中的每个分类器执行 CV过程</span><br><span class="line">    &#x27;&#x27;&#x27;</span><br><span class="line">    reporters = &#123;&#125;</span><br><span class="line">    for index, (name, clf) in enumerate(classfiers.items()):</span><br><span class="line">        logger.info(&#x27;&#123;&#125;: &#123;&#125;&#x27;.format(name, clf))</span><br><span class="line">        model, train_reporter = cv(X, y, clf)</span><br><span class="line">        model_path = config.model_path + &#x27;_&#x27; + name + &quot;_&#123;:.4f&#125;&quot;.format(train_reporter.auc)</span><br><span class="line"></span><br><span class="line">        comm.save_file(model, model_path)</span><br><span class="line">        reporters[name] = [train_reporter]</span><br><span class="line"></span><br><span class="line">    logger.info(&quot;Sum result:\n&quot;)</span><br><span class="line">    logger.info(&#x27;===========&#x27;)</span><br><span class="line">    for name, train_reporter in reporters.items():</span><br><span class="line">        logger.info(&#x27;-----&#x27;)</span><br><span class="line">        logger.info(&quot;clf: &#123;&#125;&quot;.format(name))</span><br><span class="line">        train_reporter[0].report_final_result()</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    import comm</span><br><span class="line">    from feature import Feature</span><br><span class="line"></span><br><span class="line">    f = Feature()  # 特征工程</span><br><span class="line">    train_cv(f.X, f.y)  # 十折交叉过程</span><br></pre></td></tr></table></figure>

<h3 id="预测过程"><a href="#预测过程" class="headerlink" title="预测过程"></a>预测过程</h3><p>模型训练完成以后就可以使用训练好的模型预测测试文件中的情感分类，新建 <code>predict.py</code> ，代码和解释如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import pandas as pd</span><br><span class="line"></span><br><span class="line">import comm</span><br><span class="line">from feature import Feature</span><br><span class="line"></span><br><span class="line"># 使用的模型文件</span><br><span class="line">model_path = &quot;./submissions/model_neural_clf_0.8352&quot;</span><br><span class="line">reslut_path = model_path.replace(&#x27;model&#x27;, &#x27;reslut&#x27;).replace(&#x27;0.&#x27;, &#x27;&#x27;)</span><br><span class="line">reslut_path = reslut_path + &quot;.csv&quot;  # 结果保存路径</span><br><span class="line">model = comm.load_file(model_path)  # 加载模型</span><br><span class="line"></span><br><span class="line">feature = Feature()</span><br><span class="line">test_feature = feature.test_X  # 测试文件特征</span><br><span class="line">ids = feature.test_ids</span><br><span class="line"># 预测过程，结果为两个label的概率</span><br><span class="line">predict_proba = model.predict_proba(test_feature)</span><br><span class="line">proba = predict_proba[:, 1]  # 这里只取1的概率</span><br><span class="line"></span><br><span class="line">data = []  # 最终结果</span><br><span class="line">assert len(ids) == len(proba)</span><br><span class="line">for id, p in zip(ids, proba):</span><br><span class="line">    data.append([id, p])</span><br><span class="line">result = pd.DataFrame(data, columns=[&#x27;ID&#x27;, &quot;Pred&quot;])</span><br><span class="line">comm.dump_submission(result, path=reslut_path)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>全部实验项目代码见 <a target="_blank" rel="noopener" href="https://github.com/jianchengss/kesci-sentiment-classification.git">GitHub</a></p>
<blockquote>
<p>关键字：<code>kesci</code>,<code>competition</code>, <code>sentiment</code>,<code>PyTorch</code></p>
<p>原载地址：<a target="_blank" rel="noopener" href="https://www.jiancheng.ai/2019/03/15/kesci-sentiment-classification/">https://www.jiancheng.ai/2019/03/15/kesci-sentiment-classification/</a></p>
<p>转载请注明出处！</p>
</blockquote>
</div><div class="post-copyright"><blockquote><p>原文作者: Jason Wang</p><p>原文链接: <a href="https://jianchengai.com/2019/03/15/kesci-sentiment-classification/">https://jianchengai.com/2019/03/15/kesci-sentiment-classification/</a></p><p>版权声明: 转载请注明出处(必须保留作者署名及链接)</p></blockquote></div><div class="tags"><a href="/tags/PyTorch/">PyTorch</a><a href="/tags/kesci/">kesci</a><a href="/tags/competition/">competition</a><a href="/tags/sentiment/">sentiment</a></div><div class="post-share"><div class="bdsharebuttonbox"><span style="float:left;line-height: 28px;height: 28px;font-size:16px;font-weight:blod">分享到:</span><a href="#" data-cmd="more" class="bds_more"></a><a href="#" data-cmd="mshare" title="分享到一键分享" class="bds_mshare"></a><a href="#" data-cmd="fbook" title="分享到Facebook" class="bds_fbook"></a><a href="#" data-cmd="twi" title="分享到Twitter" class="bds_twi"></a><a href="#" data-cmd="linkedin" title="分享到linkedin" class="bds_linkedin"></a><a href="#" data-cmd="youdao" title="分享到有道云笔记" class="bds_youdao"></a><a href="#" data-cmd="evernotecn" title="分享到印象笔记" class="bds_evernotecn"></a><a href="#" data-cmd="weixin" title="分享到微信" class="bds_weixin"></a><a href="#" data-cmd="qzone" title="分享到QQ空间" class="bds_qzone"></a><a href="#" data-cmd="tsina" title="分享到新浪微博" class="bds_tsina"></a></div></div><div class="post-nav"><a href="/2018/11/08/pytorch-in-action-book/" class="next">人工智能新书推荐——《PyTorch机器学习从入门到实战》</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B5%9B%E9%A2%98%E6%8F%8F%E8%BF%B0"><span class="toc-text">赛题描述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GitHub"><span class="toc-text">GitHub</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E4%BA%A4%E7%BB%93%E6%9E%9C"><span class="toc-text">提交结果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E5%AE%9E%E9%AA%8C%E8%BF%87%E7%A8%8B"><span class="toc-text">主要实验过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AC%E5%85%B1%E6%A8%A1%E5%9D%97%E5%AE%9A%E4%B9%89"><span class="toc-text">公共模块定义</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86"><span class="toc-text">数据处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%84%E4%BB%B7%E6%96%B9%E6%B3%95"><span class="toc-text">评价方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E5%BE%81%E6%8F%90%E5%8F%96"><span class="toc-text">特征提取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%AD%E7%BB%83%E8%BF%87%E7%A8%8B"><span class="toc-text">训练过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E7%B1%BB%E5%99%A8%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="toc-text">分类器的定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%AD%E7%BB%83%E8%BF%87%E7%A8%8B-1"><span class="toc-text">训练过程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%84%E6%B5%8B%E8%BF%87%E7%A8%8B"><span class="toc-text">预测过程</span></a></li></ol></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/03/15/kesci-sentiment-classification/">【科赛-练习赛】：文本情感分类模型搭建</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/08/pytorch-in-action-book/">人工智能新书推荐——《PyTorch机器学习从入门到实战》</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/05/Markdown%E4%B8%AD%E7%9A%84%E5%8F%98%E9%87%8F%E5%BC%95%E7%94%A8/">Markdown中的变量引用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/11/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%BA%90%E6%B1%87%E6%80%BB/">机器学习资源汇总</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/11/Docker-%E4%BD%BF%E7%94%A8jupyter-notebook%E5%9F%BA%E7%A1%80%E9%95%9C%E5%83%8F%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84PyTorch%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/">Docker:使用jupyter notebook基础镜像搭建自己的PyTorch开发环境</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/Docker/" style="font-size: 15px;">Docker</a> <a href="/tags/PyTorch/" style="font-size: 15px;">PyTorch</a> <a href="/tags/Markdown/" style="font-size: 15px;">Markdown</a> <a href="/tags/kesci/" style="font-size: 15px;">kesci</a> <a href="/tags/competition/" style="font-size: 15px;">competition</a> <a href="/tags/sentiment/" style="font-size: 15px;">sentiment</a> <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/" style="font-size: 15px;">人工智能</a> <a href="/tags/MachineLearning/" style="font-size: 15px;">MachineLearning</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">三月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="https://jianchengss.github.io" title="GitHub 站点" target="_blank">GitHub 站点</a><ul></ul><a href="https://jianchengss.gitee.io" title="Gitee 站点" target="_blank">Gitee 站点</a><ul></ul><a href="https://blog.csdn.net/jianchengss" title="CSDN 主页" target="_blank">CSDN 主页</a><ul></ul><a href="https://gitee.com/jianchengss" title="码云主页" target="_blank">码云主页</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |  <a href="/atom.xml">订阅本站</a> |  <a href="/about/">联系博主</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次，本站总访客数:<i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>人</p><p><span><a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33011002016723" style="display:inline-block;text-decoration:none;height:20px;line-height:10px;">
<img src="https://www.beian.gov.cn/img/new/gongan.png" /> 浙公网安备 33011002016723号</a>  |<a rel="nofollow" target="_blank" href="https://beian.miit.gov.cn/">浙ICP备2022024351号-1</a></span></p><p><span> Copyright &copy;<a href="/." rel="nofollow">Jason Wang.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a target="_blank" rel="noopener" href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.3"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  }
});</script><script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML" async></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.3" async></script><script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","weixin","tsina","qzone","linkedin","fbook","twi","print","renren","sqq","evernotecn","bdysc","tqq","tqf","bdxc","kaixin001","tieba","douban","bdhome","thx","ibaidu","meilishuo","mogujie","diandian","huaban","duitang","hx","fx","youdao","sdo","qingbiji","people","xinhua","mail","isohu","yaolan","wealink","ty","iguba","h163","copy"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":{},"image":{"viewList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"]}};with(document)0[(getElementsByTagName('head')[0]||head).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script></body></html>