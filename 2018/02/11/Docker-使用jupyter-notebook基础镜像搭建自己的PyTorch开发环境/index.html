<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><meta name="keywords" content="NLP, ML, PyTorch"><title>Docker:使用jupyter notebook基础镜像搭建自己的PyTorch开发环境 | Jason Wang</title><link rel="stylesheet" type="text/css" href="//fonts.neworld.org/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Docker:使用jupyter notebook基础镜像搭建自己的PyTorch开发环境</h1><a id="logo" href="/.">Jason Wang</a><p class="description">jianchengss</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="Arama"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">Docker:使用jupyter notebook基础镜像搭建自己的PyTorch开发环境</h1><div class="post-meta"><a href="/2018/02/11/Docker-使用jupyter-notebook基础镜像搭建自己的PyTorch开发环境/#comments" class="comment-count"></a><p><span class="date">Feb 11, 2018</span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><p>使用Docker搭建自己的PyTorch开发环境，方便迁移和远程使用。</p>
<h2 id="启动最基本的jupyter-notebook镜像："><a href="#启动最基本的jupyter-notebook镜像：" class="headerlink" title="启动最基本的jupyter notebook镜像："></a>启动最基本的jupyter notebook镜像：</h2><p>使用基础镜像<a href="https://hub.docker.com/r/jupyter/datascience-notebook/" target="_blank" rel="noopener">jupyter/datascience-notebook</a>,因为它预装了常用的模块：<code>pandas, matplotlib, scipy, seaborn, scikit-learn, scikit-image, sympy, cython, patsy, statsmodel, cloudpickle, dill, numba, bokeh</code>；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --rm -p 8888:8888 jupyter/datascience-notebook:281505737f8a</span><br></pre></td></tr></table></figure></p>
<p>其中<br><code>docker run</code>是使用一个镜像生成一个运行的容器；</p>
<p><code>-it</code>指交互模式，启动后终端在运行着的容器里面，与之对应的有<code>-d</code>后端运行模式，启动后终端交互在实体机，要想进入容器需要使用命令<code>docker exec -it container-name bash</code> <code>docker exec -it container-name</code>意为交互模式进入正在运行的一个容器，<code>bash</code>意为进入容器后使用的命令，这里用的是bash，这样进入容器后就能执行shell；</p>
<p><code>--rm</code>意为退出shell的时候自动删除容器，常在测试的时候使用，这样不用每次修改去删除已有的容器；</p>
<p><code>-p 8888:8888</code>指的是端口映射，前面的是实体机的端口，后面是容器里面暴露出的端口，两边端口可以不一样，这样同一个镜像可以启动多个对应不同端口的服务；</p>
<p><code>jupyter/datascience-notebook:281505737f8a</code>是镜像名字，冒号后面的是tag，类似于版本的概念，如果不显式的给出tag每次都回从hub上拉取latest的镜像，如果网络环境不好的话比较费时间，推荐显式给出tag，这样每次构建都会使用已有的镜像。</p>
<p>启动后就可以在终端看到：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[I 04:01:05.691 NotebookApp] Running the core application with no additional extensions or settings</span><br><span class="line">[I 04:01:05.692 NotebookApp] Serving notebooks from local directory: /home/jovyan</span><br><span class="line">[I 04:01:05.692 NotebookApp] 0 active kernels</span><br><span class="line">[I 04:01:05.692 NotebookApp] The Jupyter Notebook is running at:</span><br><span class="line">[I 04:01:05.692 NotebookApp] http://[all ip addresses on your system]:8888/?token=0a3331628e0e35f94eb0ad543faeb3e396fbccfa3ff06e5a</span><br><span class="line">[I 04:01:05.692 NotebookApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).</span><br><span class="line">[C 04:01:05.692 NotebookApp] </span><br><span class="line">    </span><br><span class="line">    Copy/paste this URL into your browser when you connect for the first time,</span><br><span class="line">    to login with a token:</span><br><span class="line">        http://localhost:8888/?token=0a3331628e0e35f94eb0ad543faeb3e396fbccfa3ff06e5a</span><br></pre></td></tr></table></figure></p>
<p>此时是停在容器里面，打开浏览器 访问<code>http://localhost:8888/?token=0a3331628e0e35f94eb0ad543faeb3e396fbccfa3ff06e5a</code> 即可打开基本的jupyter notebook 环境，后面的token是随机生成的；</p>
<h2 id="启动带权限的容器"><a href="#启动带权限的容器" class="headerlink" title="启动带权限的容器"></a>启动带权限的容器</h2><h3 id="生成自定义token"><a href="#生成自定义token" class="headerlink" title="生成自定义token"></a>生成自定义token</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Python脚本生成密码</span><br><span class="line">import IPython</span><br><span class="line">IPython.lib.passwd()</span><br></pre></td></tr></table></figure>
<p>输入密码生成token<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test的token：sha1:6587feaef3b1:6b243404e4cfaafe611fdf494ee71fdaa8c4a563</span><br></pre></td></tr></table></figure></p>
<h3 id="自定义token运行容器："><a href="#自定义token运行容器：" class="headerlink" title="自定义token运行容器："></a>自定义token运行容器：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8888:8888 jupyter/datascience-notebook start-notebook.sh --NotebookApp.password=&apos;sha1:6587feaef3b1:6b243404e4cfaafe611fdf494ee71fdaa8c4a563&apos;</span><br></pre></td></tr></table></figure>
<p>这时访问<code>http://localhost:8888/</code>会出现输入密码的页面，输入正确的密码才能进入jupyter。</p>
<h2 id="共享目录"><a href="#共享目录" class="headerlink" title="共享目录"></a>共享目录</h2><h3 id="v参数"><a href="#v参数" class="headerlink" title="-v参数"></a>-v参数</h3><p>docker提供<code>-v</code>参数使实体机和容器共享目录，这对于有状态的服务很有用，目录挂载添加参数：<br><code>-v /home/jason/jason/docker/notebook:/home/jovyan/work</code></p>
<h3 id="运行带有目录共享的容器"><a href="#运行带有目录共享的容器" class="headerlink" title="运行带有目录共享的容器"></a>运行带有目录共享的容器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --rm -p 8888:8888 -v /home/jason/jason/docker/notebook:/home/jovyan/work   jupyter/datascience-notebook start-notebook.sh --NotebookApp.password=&apos;sha1:6587feaef3b1:6b243404e4cfaafe611fdf494ee71fdaa8c4a563&apos;</span><br></pre></td></tr></table></figure>
<p>这样在jupyter里新建的notebook都会出现在实体机指定的目录里。由于这个镜像的原因 需在work目录下新建才能在实体机看到。</p>
<h2 id="基于jupyter-datascience-notebook-生成pytorch-image"><a href="#基于jupyter-datascience-notebook-生成pytorch-image" class="headerlink" title="基于jupyter/datascience-notebook 生成pytorch image"></a>基于jupyter/datascience-notebook 生成pytorch image</h2><h3 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h3><p>因为没有合适的pytorch镜像，自己编辑Dockerfile:</p>
<p>新建文件<code>Dockerfile</code>并编辑内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">FROM jupyter/datascience-notebook:281505737f8a</span><br><span class="line">MAINTAINER Jason.W. &quot;jianchengss@163.com&quot;</span><br><span class="line"># 下面是按官网的方法安装spotlight</span><br><span class="line">#RUN pip --no-cache-dir install --upgrade install http://download.pytorch.org/whl/cu75/torch-0.2.0.post3-cp36-cp36m-manylinux1_x86_64.whl </span><br><span class="line">#RUN pip --no-cache-dir install --upgrade torchvision</span><br><span class="line"></span><br><span class="line"># pytorch</span><br><span class="line">RUN conda install pytorch torchvision -c soumith</span><br><span class="line"># spotlight(https://github.com/maciejkula/spotlight)</span><br><span class="line">RUN conda install -c maciejkula -c soumith spotlight=0.1.2</span><br></pre></td></tr></table></figure>
<h3 id="build"><a href="#build" class="headerlink" title="build"></a>build</h3><p>在Dockerfile目录里运行命令：<code>docker build -t jianchengss/datascience-pytorch:0.1 .</code><br>这样就生成了image：<code>jianchengss/datascience-pytorch:0.1</code>可以运行<code>docker images</code>查看本机上所有的image。</p>
<h3 id="从构建的镜像运行容器"><a href="#从构建的镜像运行容器" class="headerlink" title="从构建的镜像运行容器"></a>从构建的镜像运行容器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --rm -p 8888:8888 -v ~/workspace/python/notebooks-pytorch:/home/jovyan/work  --privileged=true jianchengss/datascience-pytorch:0.1 start-notebook.sh --NotebookApp.password=&apos;sha1:6587feaef3b1:6b243404e4cfaafe611fdf494ee71fdaa8c4a563&apos;</span><br></pre></td></tr></table></figure>
<h3 id="最终容器"><a href="#最终容器" class="headerlink" title="最终容器"></a>最终容器</h3><p>经过以上步骤，测试完成后既可以执行最终运行的命令 注意 token换成自己的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8588:8888 -v ~/workspace/python/notebooks-pytorch:/home/jovyan/work  --privileged=true --name=pytorch jianchengss/datascience-pytorch:0.1 start-notebook.sh --NotebookApp.password=&apos;sha1:7aee2f913c8e:17d40f203cbd5c9820f302894a92724c3de9fba6&apos;</span><br></pre></td></tr></table></figure></p>
<p><code>-it --rm</code> 换成了 <code>-d</code>,比之前多的参数有：</p>
<p><code>--name=pytorch</code>，意为给container取一个名字，好区分和管理，缺省的话名字为一串随机的字符串。</p>
<p><code>--privileged=true</code>出现文件夹访问权限的时候添加该属性</p>
<p>此时运行<code>docker ps</code>即可查看运行着的容器：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CONTAINER ID        IMAGE                                 COMMAND                  CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">3bd3e30e9ab3        jianchengss/datascience-pytorch:0.1   &quot;tini -- start-notebo&quot;   4 seconds ago       Up 3 seconds        0.0.0.0:8588-&gt;8888/tcp   pytorch</span><br></pre></td></tr></table></figure></p>
<h3 id="进入容器操作"><a href="#进入容器操作" class="headerlink" title="进入容器操作"></a>进入容器操作</h3><p>容器启动后有时候需要进入容器操作，比方说查看信息或者安装新的软件，此时执行<code>docker exec -it pytorch bash</code></p>
<h3 id="其他命令"><a href="#其他命令" class="headerlink" title="其他命令"></a>其他命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker stop container-name # 停止运行着的容器</span><br><span class="line">docker rm container-name # 删除已有的容器，要先停止</span><br><span class="line">docker rmi image-name # 删除已有的镜像</span><br></pre></td></tr></table></figure>
<blockquote>
<p>关键字：<code>docker</code> <code>jupyter notebook</code> <code>pytorch</code> <code>spotlight</code></p>
<p>原载地址：<a href="http://www.jianchengss.com/2018/02/11/Docker-使用jupyter-notebook基础镜像搭建自己的PyTorch开发环境/" target="_blank" rel="noopener">http://www.jianchengss.com/2018/02/11/Docker-使用jupyter-notebook基础镜像搭建自己的PyTorch开发环境/</a></p>
<p>转载请注明出处！</p>
</blockquote>
</div><div class="tags"><a href="/tags/Docker/">Docker</a><a href="/tags/PyTorch/">PyTorch</a></div><div class="post-share"><div class="bdsharebuttonbox"><span style="float:left;line-height: 28px;height: 28px;font-size:16px;font-weight:blod">分享到：</span><a href="#" data-cmd="more" class="bds_more"></a><a href="#" data-cmd="mshare" title="分享到一键分享" class="bds_mshare"></a><a href="#" data-cmd="fbook" title="分享到Facebook" class="bds_fbook"></a><a href="#" data-cmd="twi" title="分享到Twitter" class="bds_twi"></a><a href="#" data-cmd="linkedin" title="分享到linkedin" class="bds_linkedin"></a><a href="#" data-cmd="youdao" title="分享到有道云笔记" class="bds_youdao"></a><a href="#" data-cmd="evernotecn" title="分享到印象笔记" class="bds_evernotecn"></a><a href="#" data-cmd="weixin" title="分享到微信" class="bds_weixin"></a><a href="#" data-cmd="qzone" title="分享到QQ空间" class="bds_qzone"></a><a href="#" data-cmd="tsina" title="分享到新浪微博" class="bds_tsina"></a></div></div><div class="post-nav"><a href="/2018/02/11/机器学习资源汇总/" class="pre">机器学习资源汇总</a></div><div id="comments"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#启动最基本的jupyter-notebook镜像："><span class="toc-text">启动最基本的jupyter notebook镜像：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#启动带权限的容器"><span class="toc-text">启动带权限的容器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#生成自定义token"><span class="toc-text">生成自定义token</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义token运行容器："><span class="toc-text">自定义token运行容器：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#共享目录"><span class="toc-text">共享目录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#v参数"><span class="toc-text">-v参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#运行带有目录共享的容器"><span class="toc-text">运行带有目录共享的容器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#基于jupyter-datascience-notebook-生成pytorch-image"><span class="toc-text">基于jupyter/datascience-notebook 生成pytorch image</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Dockerfile"><span class="toc-text">Dockerfile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#build"><span class="toc-text">build</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#从构建的镜像运行容器"><span class="toc-text">从构建的镜像运行容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#最终容器"><span class="toc-text">最终容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#进入容器操作"><span class="toc-text">进入容器操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#其他命令"><span class="toc-text">其他命令</span></a></li></ol></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/11/08/pytorch-in-action-book/">人工智能新书推荐——《PyTorch机器学习从入门到实战》</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/05/Markdown中的变量引用/">Markdown中的变量引用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/11/机器学习资源汇总/">机器学习资源汇总</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/11/Docker-使用jupyter-notebook基础镜像搭建自己的PyTorch开发环境/">Docker:使用jupyter notebook基础镜像搭建自己的PyTorch开发环境</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/Docker/" style="font-size: 15px;">Docker</a> <a href="/tags/PyTorch/" style="font-size: 15px;">PyTorch</a> <a href="/tags/Markdown/" style="font-size: 15px;">Markdown</a> <a href="/tags/人工智能/" style="font-size: 15px;">人工智能</a> <a href="/tags/MachineLearning/" style="font-size: 15px;">MachineLearning</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">二月 2018</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="https://jianchengss.github.io" title="GitHub 站点" target="_blank">GitHub 站点</a><ul></ul><a href="https://jianchengss.gitee.io" title="Gitee 站点" target="_blank">Gitee 站点</a><ul></ul><a href="https://blog.csdn.net/jianchengss" title="CSDN 主页" target="_blank">CSDN 主页</a><ul></ul><a href="https://gitee.com/jianchengss" title="码云主页" target="_blank">码云主页</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">Baidu Site Haritası</a> |  <a href="/atom.xml">订阅</a> |  <a href="/about/">关于</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次</p><p><span> Copyright &copy;<a href="/." rel="nofollow">Jason Wang.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.1"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.1" async></script><script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","weixin","tsina","qzone","linkedin","fbook","twi","print","renren","sqq","evernotecn","bdysc","tqq","tqf","bdxc","kaixin001","tieba","douban","bdhome","thx","ibaidu","meilishuo","mogujie","diandian","huaban","duitang","hx","fx","youdao","sdo","qingbiji","people","xinhua","mail","isohu","yaolan","wealink","ty","iguba","h163","copy"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":{},"image":{"viewList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"]}};with(document)0[(getElementsByTagName('head')[0]||head).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script></body></html>